{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/utils/supabaseClient.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_PUBLIC_ANON_KEY;\r\n\r\nconsole.log(\"Supabase URL:\", supabaseUrl);\r\nconsole.log(\"Supabase Key:\", supabaseKey ? \"✅ Loaded\" : \"❌ Not Found\");\r\n\r\nif (!supabaseUrl || !supabaseKey) {\r\n  throw new Error('Supabase URL and Key are required');\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey);\r\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEN,QAAQ,GAAG,CAAC,iBAAiB;AAC7B,QAAQ,GAAG,CAAC,iBAAiB,uCAAc;AAE3C,uCAAkC;;AAElC;AAEO,MAAM,WAAW,CAAA,GAAA,yLAAA,CAAA,eAAY,AAAD,EAAE,aAAa"}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/api.js"],"sourcesContent":["import { MercadoPagoConfig, Preference, OAuth } from \"mercadopago\";\r\nimport { supabase } from \"./utils/supabaseClient\";\r\n\r\n// Configuración de Mercado Pago\r\nexport const mercadopago = new MercadoPagoConfig({ accessToken: process.env.MP_ACCESS_TOKEN });\r\n\r\nconst api = {\r\n  oauth: {\r\n    // Genera la URL para que los vendedores autoricen la app y obtengan un access_token\r\n    getAuthURL() {\r\n      const clientId = process.env.NEXT_PUBLIC_MP_CLIENT_ID;\r\n      const redirectUri = `${process.env.APP_URL}/api/mercadopago/connect`;\r\n      return `https://auth.mercadopago.com/authorization?client_id=${clientId}&response_type=code&platform_id=mp&redirect_uri=${redirectUri}`;\r\n    },\r\n\r\n    // Intercambia el authorization_code por un access_token del vendedor\r\n    async exchangeCode(code) {\r\n      const oauth = new OAuth(mercadopago);\r\n      try {\r\n        const response = await oauth.token({\r\n          client_secret: process.env.MP_CLIENT_SECRET,\r\n          grant_type: \"authorization_code\",\r\n          code,\r\n          redirect_uri: `${process.env.APP_URL}/api/mercadopago/connect`,\r\n        });\r\n\r\n        const { access_token, refresh_token, user_id } = response || {};\r\n        if (!user_id) throw new Error(\"No se recibió user_id de MercadoPago\");\r\n\r\n        const { data, error } = await supabase\r\n          .from(\"clients\")\r\n          .upsert([{ user_id, access_token, refresh_token }]);\r\n\r\n        if (error) throw new Error(\"Error al guardar el vendedor: \" + error.message);\r\n        \r\n        return { user_id, access_token };\r\n      } catch (error) {\r\n        throw new Error(\"Error en OAuth: \" + error.message);\r\n      }\r\n    },\r\n\r\n    // Refresca el access_token del vendedor si ha expirado\r\n    async refreshToken(refreshToken) {\r\n      const oauth = new OAuth(mercadopago);\r\n      try {\r\n        const response = await oauth.token({\r\n          client_secret: process.env.MP_CLIENT_SECRET,\r\n          grant_type: \"refresh_token\",\r\n          refresh_token: refreshToken,\r\n        });\r\n\r\n        const { access_token, refresh_token } = response;\r\n        return { access_token, refresh_token };\r\n      } catch (error) {\r\n        throw new Error(\"Error al refrescar el token: \" + error.message);\r\n      }\r\n    },\r\n\r\n    // Conectar el usuario usando el código de autorización\r\n    async connect(code) {\r\n      try {\r\n        const credentials = await new OAuth(mercadopago).token({\r\n          client_secret: process.env.MP_CLIENT_SECRET,\r\n          grant_type: \"authorization_code\",\r\n          code,\r\n          redirect_uri: `${process.env.APP_URL}/api/mercadopago/connect`,\r\n        });\r\n\r\n        const { user_id, access_token, refresh_token } = credentials || {};\r\n        if (!user_id) throw new Error(\"No se recibió user_id de MercadoPago\");\r\n\r\n        const { data, error } = await supabase\r\n          .from(\"clients\")\r\n          .upsert([{ user_id, access_token, refresh_token }]);\r\n\r\n        if (error) throw new Error(\"Error al guardar las credenciales\");\r\n\r\n        return { message: \"Conexión exitosa\", user_id, access_token };\r\n      } catch (error) {\r\n        throw new Error(\"Error al conectar con Mercado Pago\");\r\n      }\r\n    },\r\n  },\r\n\r\n  sale: {\r\n    async create({ sellerId, items, totalAmount }) {\r\n      const { data, error } = await supabase\r\n        .from(\"clients\")\r\n        .select(\"access_token\")\r\n        .eq(\"user_id\", sellerId)\r\n        .maybeSingle();\r\n\r\n      if (error || !data || !data.access_token) {\r\n        throw new Error(\"No se encontró el vendedor o su access_token no es válido\");\r\n      }\r\n\r\n      const sellerAccessToken = data.access_token;\r\n      \r\n      const preference = await new Preference(new MercadoPagoConfig({ accessToken: sellerAccessToken })).create({\r\n        body: {\r\n          items: items.map((item) => ({\r\n            id: item.id,\r\n            title: item.name,\r\n            quantity: item.quantity,\r\n            unit_price: item.price,\r\n            currency_id: \"ARS\", // Moneda obligatoria\r\n          })),\r\n          marketplace_fee: totalAmount * 0.10, // 10% de comisión\r\n          payer: {\r\n            email: \"comprador@example.com\",\r\n          },\r\n        },\r\n      });\r\n      \r\n      const { data: saleData, error: saleError } = await supabase\r\n        .from(\"sales\")\r\n        .insert([{ sale_id: preference.id, user_id: sellerId, amount: totalAmount, status: \"pendiente\", items }]);\r\n\r\n      if (saleError) throw new Error(\"Error al registrar la venta: \" + saleError.message);\r\n\r\n      return { init_point: preference.init_point, sale: saleData };\r\n    },\r\n  },\r\n};\r\n\r\nexport default api;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 258, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/app/api/mercadopago/connect/route.js"],"sourcesContent":["import { NextResponse} from \"next/server\";\r\nimport api from \"../../../../api\";\r\n\r\n// Queremos que esta página sea dinámica para saber el estado del marketplace\r\nexport const revalidate = 10; // Revalidar cada 10 segundos, por ejemplo\r\nexport async function GET(request) {\r\n  // Obtenemos el code de la request\r\n  const code = request.nextUrl.searchParams.get(\"code\");\r\n\r\n  // Conectamos al usuario con el code y obtenemos las credenciales\r\n  const credentials = await api.user.connect(code);\r\n\r\n  // Actualizamos las credenciales del usuario\r\n  await api.user.update({ marketplace: credentials.access_token });\r\n\r\n  // Redirigimos al usuario a la página del marketplace\r\n  return NextResponse.redirect(`${process.env.APP_URL}/api/paymentResume`);\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,MAAM,aAAa,IAAI,0CAA0C;AACjE,eAAe,IAAI,OAAO;IAC/B,kCAAkC;IAClC,MAAM,OAAO,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAE9C,iEAAiE;IACjE,MAAM,cAAc,MAAM,qGAAA,CAAA,UAAG,CAAC,IAAI,CAAC,OAAO,CAAC;IAE3C,4CAA4C;IAC5C,MAAM,qGAAA,CAAA,UAAG,CAAC,IAAI,CAAC,MAAM,CAAC;QAAE,aAAa,YAAY,YAAY;IAAC;IAE9D,qDAAqD;IACrD,OAAO,gIAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,GAAG,QAAQ,GAAG,CAAC,OAAO,CAAC,kBAAkB,CAAC;AACzE"}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}