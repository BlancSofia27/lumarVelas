{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/app/api/mercadopago/preference/route.js"],"sourcesContent":["import mercadopago from \"mercadopago\"\r\n\r\nmercadopago.configurations.setAccessToken(process.env.NEXT_PUBLIC_MP_ACCESS_TOKEN)\r\n\r\nexport async function POST(req) {\r\n  const { items } = await req.json()\r\n\r\n  try {\r\n    // Calcular el total de la compra\r\n    const totalAmount = items.reduce(\r\n      (acc, item) => acc + item.price * item.quantity,\r\n      0\r\n    )\r\n\r\n    // Definir el porcentaje para el marketplace (15%)\r\n    const marketplacePercentage = 0.15 // 15%\r\n    const marketplaceAmount = totalAmount * marketplacePercentage\r\n\r\n    const preference = {\r\n      payer: { id: \"payer_id\" }, // Reemplazar con el ID real del pagador\r\n      items: items.map((item) => ({\r\n        title: item.name,\r\n        quantity: item.quantity,\r\n        unit_price: item.price,\r\n      })),\r\n      payments: {\r\n        split_rules: [\r\n          {\r\n            receiver_id: process.env.MARKETPLACE_ID, // Usar tu ID de cuenta de marketplace\r\n            percentage: marketplacePercentage * 100, // Mercado Pago espera el porcentaje como un valor entre 0 y 100\r\n            charge_fee: true, // Configura esto según si el marketplace debe pagar la comisión\r\n          },\r\n          // Aquí puedes añadir otras reglas de división para los vendedores si es necesario\r\n        ],\r\n      },\r\n      back_urls: {\r\n        success: `${process.env.APP_URL}/api/payment-success`,\r\n        failure: `${process.env.APP_URL}/api/payment-failure`,\r\n      },\r\n    }\r\n\r\n    const response = await mercadopago.preferences.create(preference)\r\n\r\n    return new Response(\r\n      JSON.stringify({ init_point: response.body.init_point }),\r\n      { status: 200 }\r\n    )\r\n  } catch (error) {\r\n    console.error(error)\r\n    return new Response(\r\n      JSON.stringify({ error: \"Error al crear la preferencia\" }),\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAEA,8IAAA,CAAA,UAAW,CAAC,cAAc,CAAC,cAAc;AAElC,eAAe,KAAK,GAAG;IAC5B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;IAEhC,IAAI;QACF,iCAAiC;QACjC,MAAM,cAAc,MAAM,MAAM,CAC9B,CAAC,KAAK,OAAS,MAAM,KAAK,KAAK,GAAG,KAAK,QAAQ,EAC/C;QAGF,kDAAkD;QAClD,MAAM,wBAAwB,KAAK,MAAM;;QACzC,MAAM,oBAAoB,cAAc;QAExC,MAAM,aAAa;YACjB,OAAO;gBAAE,IAAI;YAAW;YACxB,OAAO,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;oBAC1B,OAAO,KAAK,IAAI;oBAChB,UAAU,KAAK,QAAQ;oBACvB,YAAY,KAAK,KAAK;gBACxB,CAAC;YACD,UAAU;gBACR,aAAa;oBACX;wBACE,aAAa,QAAQ,GAAG,CAAC,cAAc;wBACvC,YAAY,wBAAwB;wBACpC,YAAY;oBACd;iBAED;YACH;YACA,WAAW;gBACT,SAAS,GAAG,QAAQ,GAAG,CAAC,OAAO,CAAC,oBAAoB,CAAC;gBACrD,SAAS,GAAG,QAAQ,GAAG,CAAC,OAAO,CAAC,oBAAoB,CAAC;YACvD;QACF;QAEA,MAAM,WAAW,MAAM,8IAAA,CAAA,UAAW,CAAC,WAAW,CAAC,MAAM,CAAC;QAEtD,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YAAE,YAAY,SAAS,IAAI,CAAC,UAAU;QAAC,IACtD;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YAAE,OAAO;QAAgC,IACxD;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}